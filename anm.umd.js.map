{"version":3,"sources":["webpack://anm/webpack/universalModuleDefinition","webpack://anm/webpack/bootstrap","webpack://anm/./packages/types.ts","webpack://anm/./packages/EventEmitter.ts","webpack://anm/./packages/bus.ts","webpack://anm/./packages/kit.ts","webpack://anm/./packages/patchs.ts","webpack://anm/./packages/vnode.ts","webpack://anm/./packages/hooks.ts","webpack://anm/./packages/createElement.ts","webpack://anm/./packages/render.ts","webpack://anm/./packages/index.ts"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","ignoreProps","children","ref","EventEmitter","_classCallCheck","this","eventNameToHandlers","eventName","handler","push","handlers","readyRemove","length","_i","splice","_len","arguments","params","Array","_key","forEach","f","apply","packages_bus","executor","requestAnimationFrame","Promise","resolve","reject","err","setTimeout","isNumber","arg","isFunction","document","createAttributeNS","isString","isArray","isNullOrUndef","isEventAttr","attr","startsWith","realEventName","node","nodeName","toLowerCase","type","test","onEvent","e","realName","addEventListener","slice","offEvent","removeEventListener","IS_NON_DIMENSIONAL","setStyle","domStyle","style","isNaN","setProp","tickBus","pending","nextTick2","emit","patch","vnode","rendered","old","vtype","component","original","unmountRecursively","domNode","vnodeToDomNode","parentElement","replaceChild","props","patchProps","patchChildren","runPendingEffects","prevProps","nextProps","textContent","removeAttribute","_p","prevValue","nextValue","className","lastHtml","__html","nextHtml","innerHTML","cssText","_key2","_value","error","parent","lastChildren","nextChildren","parentDom","lastLength","nextLength","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","iterator","next","done","child","appendChild","return","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","minLength","Math","min","last","patchBothChild","removeChild","id","stack","pop","_toConsumableArray","filter","on","setInterval","idToVNode","elem","createTextNode","createElement","renderedVNode","runPendingEffectReturns","_vnode","updateVNode","vnode_typeof","pendingEffects","effectReturn","effect","pendingEffectReturns","idCounter","currId","iterState","iterEffect","idToSE","useState","initState","states","effects","se","state","useEffect","inputs","effected","a","b","aIsArr","bIsArr","equalsArray","addPendingEffect","JSON","stringify","obj","isArr","reduce","prev","curr","createElement_toConsumableArray","packType","beginRender","createElement_typeof","_typeof","render","container","callback","__webpack_exports__","h"],"mappings":"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","file":"anm.umd.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"anm\"] = factory();\n\telse\n\t\troot[\"anm\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export type VNodeType = 'text' | 'dom' | 'component';\r\nexport type TextVNodeType = string;\r\nexport type DOMVNodeType = string;\r\nexport type ComponentVNodeType<Props extends IProps = IProps> = ((\r\n\tprops: Readonly<Props>\r\n) => VNode) & {\r\n\toriginal: Function;\r\n};\r\n\r\nexport type Ref = (elem: Element | null) => void;\r\n\r\nexport interface Effect {\r\n\t(): void | (() => void);\r\n}\r\n\r\nexport interface IProps {\r\n\tchildren?: VNode | VNode[];\r\n\tref?: Ref;\r\n\tkey?: string;\r\n\t[k: string]: any;\r\n\t[k: number]: any;\r\n}\r\n\r\nexport const ignoreProps: { [key: string]: boolean } = {\r\n\tchildren: true,\r\n\tref: true,\r\n\tkey: true\r\n};\r\n\r\nexport interface VNode<Props extends IProps = IProps> {\r\n\tvtype: VNodeType;\r\n\tcomponent: TextVNodeType | DOMVNodeType | ComponentVNodeType<Props>;\r\n\tprops: Props;\r\n\tdomNode?: Node;\r\n\tparent?: VNode;\r\n\tchildren?: VNode[];\r\n\t// for functional component\r\n\tid?: number;\r\n\trendered?: VNode;\r\n\tpendingEffects?: Effect[];\r\n\tpendingEffectReturns?: (() => void)[];\r\n}\r\n\r\nexport function isVNode(obj: any): boolean {\r\n\treturn typeof obj === 'object' && obj.vtype && obj.component;\r\n}\r\n","export default class EventEmitter {\r\n\tprivate eventNameToHandlers: { [name: string]: Function[] } = {};\r\n\r\n\ton(eventName: string, handler: Function) {\r\n\t\tif (!this.eventNameToHandlers[eventName]) {\r\n\t\t\tthis.eventNameToHandlers[eventName] = [];\r\n\t\t}\r\n\t\tthis.eventNameToHandlers[eventName].push(handler);\r\n\t}\r\n\r\n\toff(eventName: string, handler: Function) {\r\n\t\tif (this.eventNameToHandlers[eventName]) {\r\n\t\t\tconst handlers = this.eventNameToHandlers[eventName];\r\n\t\t\tconst readyRemove: number[] = [];\r\n\t\t\tfor (let i = 0; i < handlers.length; i++) {\r\n\t\t\t\tif (handlers[i] === handler) {\r\n\t\t\t\t\treadyRemove.push(i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (let i = readyRemove.length - 1; i > -1; i--) {\r\n\t\t\t\thandlers.splice(readyRemove[i], 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\temit(eventName: string, ...params: any[]) {\r\n\t\tif (this.eventNameToHandlers[eventName]) {\r\n\t\t\tthis.eventNameToHandlers[eventName].forEach((f) => {\r\n\t\t\t\tf(...params);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n","import EventEmitter from './EventEmitter';\r\n\r\nconst bus = new EventEmitter();\r\n\r\nexport default bus;\r\n","import {VNode} from './types';\r\nimport EventEmitter from './EventEmitter';\r\n// import {fromEvent} from 'rxjs';\r\n// import {bufferTime} from 'rxjs/operators';\r\n// import {animationFrame} from 'rxjs/internal/scheduler/animationFrame';\r\n\r\nexport const executor: (f: () => void) => void =\r\n\twindow.requestAnimationFrame ?\r\n\t\twindow.requestAnimationFrame :\r\n\t\t(window as any).Promise ?\r\n\t\t\t(f: () => void) => (new Promise(((resolve, reject) => {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tf();\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\treject(err)\r\n\t\t\t\t}\r\n\t\t\t})))\r\n\t\t\t: window.setTimeout;\r\n\r\nexport function isNumber(arg: any): arg is number {\r\n\treturn typeof arg === 'number';\r\n}\r\n\r\nexport const isSupportSVG = isFunction(document.createAttributeNS);\r\n\r\nexport function isString(arg: any): arg is string {\r\n\treturn typeof arg === 'string';\r\n}\r\n\r\nexport function isFunction(arg: any): arg is Function {\r\n\treturn typeof arg === 'function';\r\n}\r\n\r\nexport function isBoolean(arg: any): arg is true | false {\r\n\treturn arg === true || arg === false;\r\n}\r\n\r\nexport const isArray = Array.isArray;\r\n\r\nexport function isObject(arg: any): arg is Object {\r\n\treturn arg === Object(arg) && !isFunction(arg);\r\n}\r\n\r\nexport function isUndefined(o: any): o is undefined {\r\n\treturn o === undefined;\r\n}\r\n\r\nexport function isNullOrUndef(o: any): o is undefined | null {\r\n\treturn o === undefined || o === null;\r\n}\r\n\r\nexport function isInvalid(o: any): o is undefined | null | true | false {\r\n\treturn isNullOrUndef(o) || o === true || o === false;\r\n}\r\n\r\nexport function isEventAttr(attr: string): boolean {\r\n\treturn attr.startsWith('on');\r\n}\r\n\r\nexport function isKeyed(lastChildren: VNode[], nextChildren: VNode[]): boolean {\r\n\treturn (\r\n\t\tnextChildren.length > 0 &&\r\n\t\t!isNullOrUndef(nextChildren[0]) &&\r\n\t\t!isNullOrUndef(nextChildren[0].props.key) &&\r\n\t\tlastChildren.length > 0 &&\r\n\t\t!isNullOrUndef(lastChildren[0]) &&\r\n\t\t!isNullOrUndef(lastChildren[0].props.key)\r\n\t);\r\n}\r\n\r\nexport function realEventName(node: Element, eventName: string): string {\r\n\tif (eventName === 'onDoubleClick') {\r\n\t\teventName = 'ondblclick';\r\n\t} else if (eventName === 'onTouchTap') {\r\n\t\teventName = 'onclick';\r\n\t} else if (eventName === 'onChange') {\r\n\t\tconst nodeName = node.nodeName && node.nodeName.toLowerCase();\r\n\t\tconst type = (node as HTMLInputElement).type;\r\n\t\tif (\r\n\t\t\t(nodeName === 'input' && /text|password/.test(type)) ||\r\n\t\t\tnodeName === 'textarea'\r\n\t\t)\r\n\t\t\teventName = 'oninput';\r\n\t} else {\r\n\t\teventName = eventName.toLowerCase();\r\n\t}\r\n\treturn eventName;\r\n}\r\n\r\nexport function onEvent(e: Element, name: string, handler: Function) {\r\n\tconst realName = realEventName(e, name);\r\n\tif (realName in e) {\r\n\t\t(e as any)[realName] = handler;\r\n\t} else {\r\n\t\te.addEventListener(\r\n\t\t\trealName.slice(2) /* trim left \"on\" */,\r\n\t\t\thandler as any\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport function offEvent(e: Element, name: string, handler: Function) {\r\n\tconst realName = realEventName(e, name);\r\n\tif (realName in e) {\r\n\t\t(e as any)[realName] = null;\r\n\t} else {\r\n\t\te.removeEventListener(\r\n\t\t\trealName.slice(2) /* trim left \"on\" */,\r\n\t\t\thandler as any\r\n\t\t);\r\n\t}\r\n}\r\n\r\nconst IS_NON_DIMENSIONAL = /acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i;\r\n\r\nexport function setStyle(\r\n\tdomStyle: CSSStyleDeclaration,\r\n\tstyle: string,\r\n\tvalue: string\r\n) {\r\n\tif (isNullOrUndef(value) || (isNumber(value) && isNaN(value))) {\r\n\t\t(domStyle as any)[style] = '';\r\n\t\treturn;\r\n\t}\r\n\tif (style === 'float') {\r\n\t\tdomStyle['cssFloat'] = value;\r\n\t\t(domStyle as any)['styleFloat'] = value;\r\n\t\treturn;\r\n\t}\r\n\t(domStyle as any)[style] =\r\n\t\t!isNumber(value) || IS_NON_DIMENSIONAL.test(style)\r\n\t\t\t? value\r\n\t\t\t: value + 'px';\r\n}\r\n\r\nexport function setProp(node: Element, name: string, value: any) {\r\n\ttry {\r\n\t\t(node as any)[name] = value;\r\n\t} catch (e) {\r\n\t}\r\n}\r\n\r\nexport function nextTick(f: () => void) {\r\n\t// const tick = window.requestAnimationFrame\r\n\t// \t? window.requestAnimationFrame\r\n\t// \t: (window as any).Promise\r\n\t// \t\t? (f: Function) =>\r\n\t// \t\t\tnew Promise((resolve, reject) => {\r\n\t// \t\t\t\ttry {\r\n\t// \t\t\t\t\tf();\r\n\t// \t\t\t\t\tresolve();\r\n\t// \t\t\t\t} catch (error) {\r\n\t// \t\t\t\t\tconsole.error(error);\r\n\t// \t\t\t\t\treject(error);\r\n\t// \t\t\t\t}\r\n\t// \t\t\t})\r\n\t// \t\t: window.setTimeout;\r\n\t// tick(f);\r\n\t// animationFrame.schedule(f);\r\n\texecutor(f)\r\n}\r\n\r\n\r\nconst tickBus = new EventEmitter();\r\n// const tick$ = fromEvent<() => void>(tickBus, 'add').pipe(\r\n// \tbufferTime(1000 / (60 * 1.5), animationFrame)\r\n// );\r\n// tick$.subscribe((fs) => {\r\n// \tfs.forEach((f) => {\r\n// \t\ttry {\r\n// \t\t\tf();\r\n// \t\t} catch (error) {\r\n// \t\t}\r\n// \t});\r\n// });\r\nconst pending: Function[] = [];\r\ntickBus.on(\"add\", (f) => {\r\n\tpending.push(f)\r\n})\r\nsetInterval(() => {\r\n\tpending.forEach(f => f());\r\n\tpending.splice(0, pending.length);\r\n}, 1000 / 60)\r\n\r\nexport function nextTick2(f: () => void) {\r\n\ttickBus.emit('add', f);\r\n}\r\n\r\nexport function equalsArray(a?: any[], b?: any[]): boolean {\r\n\tconst aIsArr = Array.isArray(a);\r\n\tconst bIsArr = Array.isArray(b);\r\n\tif (aIsArr && !bIsArr) return false;\r\n\telse if (!aIsArr && bIsArr) return false;\r\n\telse if (!aIsArr && !bIsArr) return false;\r\n\telse {\r\n\t\t(a = a!);\r\n\t\t(b = b!);\r\n\t\tif (a.length !== b.length) return false;\r\n\t\tfor (let i = 0; i < a.length; i++) {\r\n\t\t\tif (a[i] !== b[i]) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n/**\r\n * Slightly modified Longest Increased Subsequence algorithm, it ignores items that have -1 value, they're representing\r\n * new items.\r\n *\r\n * http://en.wikipedia.org/wiki/Longest_increasing_subsequence\r\n *\r\n * @param a Array of numbers.\r\n * @returns Longest increasing subsequence.\r\n */\r\nexport function lis(a: number[]): number[] {\r\n\tconst p = a.slice();\r\n\tconst result: number[] = [];\r\n\tresult.push(0);\r\n\tlet u: number;\r\n\tlet v: number;\r\n\r\n\tfor (let i = 0, il = a.length; i < il; ++i) {\r\n\t\tif (a[i] === -1) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tconst j = result[result.length - 1];\r\n\t\tif (a[j] < a[i]) {\r\n\t\t\tp[i] = j;\r\n\t\t\tresult.push(i);\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tu = 0;\r\n\t\tv = result.length - 1;\r\n\r\n\t\twhile (u < v) {\r\n\t\t\tconst c = ((u + v) / 2) | 0;\r\n\t\t\tif (a[result[c]] < a[i]) {\r\n\t\t\t\tu = c + 1;\r\n\t\t\t} else {\r\n\t\t\t\tv = c;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (a[i] < a[result[u]]) {\r\n\t\t\tif (u > 0) {\r\n\t\t\t\tp[i] = result[u - 1];\r\n\t\t\t}\r\n\t\t\tresult[u] = i;\r\n\t\t}\r\n\t}\r\n\r\n\tu = result.length;\r\n\tv = result[u - 1];\r\n\r\n\twhile (u-- > 0) {\r\n\t\tresult[u] = v;\r\n\t\tv = p[v];\r\n\t}\r\n\r\n\treturn result;\r\n}","import bus from './bus';\r\nimport {runPendingEffectReturns, runPendingEffects, vnodeToDomNode} from './vnode';\r\nimport {\r\n\tisEventAttr,\r\n\tisFunction,\r\n\tisKeyed,\r\n\tisNullOrUndef,\r\n\tisString,\r\n\tnextTick2,\r\n\toffEvent,\r\n\tonEvent,\r\n\tsetStyle,\r\n\tlis\r\n} from './kit';\r\nimport {ComponentVNodeType, ignoreProps, IProps, VNode} from './types';\r\n\r\nexport function patch(vnode: VNode, rendered: VNode) {\r\n\tconst old = vnode.rendered!;\r\n\t// Replace directly with different types of nodes\r\n\tif (\r\n\t\told.vtype !== rendered.vtype ||\r\n\t\t(old.vtype === 'component' &&\r\n\t\t\t(old.component as ComponentVNodeType).original !==\r\n\t\t\t(rendered.component as ComponentVNodeType).original) ||\r\n\t\told.component !== rendered.component\r\n\t) {\r\n\t\tunmountRecursively(old);\r\n\t\tconst domNode = vnodeToDomNode(rendered);\r\n\t\tvnode.domNode!.parentElement!.replaceChild(domNode, vnode.domNode!);\r\n\t\tvnode.domNode = domNode;\r\n\t\tvnode.props.ref && vnode.props.ref(domNode as any);\r\n\t\tvnode.rendered = rendered;\r\n\t\treturn;\r\n\t}\r\n\tif (\r\n\t\told.vtype === 'dom' &&\r\n\t\trendered.vtype === 'dom' &&\r\n\t\told.component === rendered.component\r\n\t)\r\n\t\tpatchProps(old.domNode as any, old, old.props, rendered.props);\r\n\tpatchChildren(old, old.children!, rendered.children!);\r\n\t// runPendingEffectReturns(vnode);\r\n\trunPendingEffects(vnode)\r\n}\r\n\r\nfunction patchProps(\r\n\tdomNode: Element,\r\n\tvnode: VNode,\r\n\tprevProps: IProps,\r\n\tnextProps: IProps\r\n) {\r\n\t// remove properties which don't contained in nextProps\r\n\tfor (let p in prevProps) {\r\n\t\tif (ignoreProps[p]) continue;\r\n\t\tconst value = prevProps[p];\r\n\t\tif (isNullOrUndef(nextProps[p])) {\r\n\t\t\tif (isEventAttr(p)) {\r\n\t\t\t\toffEvent(domNode, p, value);\r\n\t\t\t} else if (p === 'dangerouslySetInnerHTML') {\r\n\t\t\t\tdomNode.textContent = '';\r\n\t\t\t} else if (p === 'className') {\r\n\t\t\t\tdomNode.removeAttribute('class');\r\n\t\t\t} else {\r\n\t\t\t\tdomNode.removeAttribute(p);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t// patch new properties to dom node\r\n\tfor (let p in nextProps) {\r\n\t\tconst prevValue = prevProps[p];\r\n\t\tconst nextValue = nextProps[p];\r\n\t\tif (prevValue === nextValue && p !== 'value') continue;\r\n\t\t// If the before and after values are different\r\n\t\t// or property is value (fix the value update for textarea/input)\r\n\t\tif (p === 'className') {\r\n\t\t\tp = 'class';\r\n\t\t}\r\n\t\tif (ignoreProps[p]) continue;\r\n\t\tif (p === 'class') {\r\n\t\t\tdomNode.className = nextValue;\r\n\t\t} else if (p === 'dangerouslySetInnerHTML') {\r\n\t\t\tconst lastHtml = prevValue && prevValue.__html;\r\n\t\t\tconst nextHtml = nextValue && nextValue.__html;\r\n\t\t\tif (lastHtml !== nextHtml && !isNullOrUndef(nextHtml))\r\n\t\t\t\tdomNode.innerHTML = nextHtml;\r\n\t\t} else if (\r\n\t\t\tisEventAttr(p) &&\r\n\t\t\tprevValue !== nextValue &&\r\n\t\t\tisFunction(nextValue)\r\n\t\t) {\r\n\t\t\toffEvent(domNode, p, prevValue);\r\n\t\t\tonEvent(domNode, p, nextValue);\r\n\t\t} else if (p === 'style') {\r\n\t\t\tconst style = (domNode as HTMLElement).style;\r\n\t\t\tif (isString(nextValue)) {\r\n\t\t\t\tstyle.cssText = nextValue;\r\n\t\t\t} else if (!isNullOrUndef(prevValue) && !isString(prevValue)) {\r\n\t\t\t\t// set new style value to dom node for any key in next style value\r\n\t\t\t\tfor (let key in nextValue) {\r\n\t\t\t\t\tconst value = nextValue[key];\r\n\t\t\t\t\tif (value !== prevValue[key]) {\r\n\t\t\t\t\t\tsetStyle(style, key, value);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// remove prev style if it contained in prev style but not in next style\r\n\t\t\t\tfor (let key in prevValue) {\r\n\t\t\t\t\tif (isNullOrUndef(nextValue[key])) {\r\n\t\t\t\t\t\tstyle[key as any] = '';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor (let key in nextValue) {\r\n\t\t\t\t\tconst value = nextValue[key];\r\n\t\t\t\t\tsetStyle(style, key, value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (p !== 'list' && p !== 'type' && p in domNode) {\r\n\t\t\ttry {\r\n\t\t\t\t(domNode as any)[p] = nextValue || '';\r\n\t\t\t} catch (error) {\r\n\t\t\t}\r\n\t\t\tif (!nextValue) {\r\n\t\t\t\tdomNode.removeAttribute(p);\r\n\t\t\t}\r\n\t\t} else if (!nextValue) {\r\n\t\t\tdomNode.removeAttribute(p);\r\n\t\t} else {\r\n\t\t\t// TODO: svg support\r\n\t\t}\r\n\t}\r\n\tvnode.props = nextProps;\r\n}\r\n\r\nfunction patchChildren(\r\n\tparent: VNode,\r\n\tlastChildren: VNode[],\r\n\tnextChildren: VNode[]\r\n) {\r\n\tconst parentDom = parent.domNode!;\r\n\tconst lastLength = lastChildren.length;\r\n\tconst nextLength = nextChildren.length;\r\n\tif (lastLength === 0) {\r\n\t\tfor (let child of nextChildren) {\r\n\t\t\tvnodeToDomNode(child);\r\n\t\t\tparentDom.appendChild(child.domNode!);\r\n\t\t}\r\n\t} else if (nextLength === 0) {\r\n\t\tparentDom.textContent = '';\r\n\t\tfor (let child of lastChildren) {\r\n\t\t\tunmountRecursively(child);\r\n\t\t}\r\n\t} else {\r\n\t\t/*if (isKeyed(lastChildren, nextChildren)) {\r\n\t\t\tlet lastBegin = 0,\r\n\t\t\t\tlastEnd = lastChildren.length - 1;\r\n\t\t\tlet nextBegin = 0,\r\n\t\t\t\tnextEnd = nextChildren.length - 1;\r\n\t\t\twhile (\r\n\t\t\t\tlastChildren[lastBegin].props.key ===\r\n\t\t\t\t\tnextChildren[nextBegin].props.key &&\r\n\t\t\t\tlastBegin <= lastEnd &&\r\n\t\t\t\tnextBegin <= nextEnd\r\n\t\t\t) {\r\n\t\t\t\tpatchBothChild(\r\n\t\t\t\t\tnextChildren[nextBegin],\r\n\t\t\t\t\tlastChildren[lastBegin],\r\n\t\t\t\t\tnextChildren,\r\n\t\t\t\t\tnextBegin,\r\n\t\t\t\t\tparent\r\n\t\t\t\t);\r\n\r\n\t\t\t\tlastBegin++;\r\n\t\t\t\tnextBegin++;\r\n\t\t\t}\r\n\t\t\twhile (\r\n\t\t\t\tlastChildren[lastEnd].props.key ===\r\n\t\t\t\t\tnextChildren[nextEnd].props.key &&\r\n\t\t\t\tlastBegin <= lastEnd &&\r\n\t\t\t\tnextBegin <= nextEnd\r\n\t\t\t) {\r\n\t\t\t\tpatchBothChild(\r\n\t\t\t\t\tnextChildren[nextEnd],\r\n\t\t\t\t\tlastChildren[lastEnd],\r\n\t\t\t\t\tnextChildren,\r\n\t\t\t\t\tnextEnd,\r\n\t\t\t\t\tparent\r\n\t\t\t\t);\r\n\r\n\t\t\t\tlastEnd--;\r\n\t\t\t\tnextEnd--;\r\n\t\t\t}\r\n\r\n\t\t\tif (lastBegin > lastEnd) {\r\n\t\t\t\tif (nextBegin <= nextEnd) {\r\n\t\t\t\t\tfor (let i = nextBegin; i <= nextEnd; i++) {\r\n\t\t\t\t\t\tvnodeToDomNode(nextChildren[i]);\r\n\t\t\t\t\t\tif (lastBegin <= nextEnd) {\r\n\t\t\t\t\t\t\tparentDom.appendChild(nextChildren[i].domNode!);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tparentDom.insertBefore(\r\n\t\t\t\t\t\t\t\tnextChildren[i].domNode!,\r\n\t\t\t\t\t\t\t\tlastChildren[lastBegin].domNode!\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnextBegin = nextEnd + 1;\r\n\t\t\t\t}\r\n\t\t\t} else if (nextBegin > nextEnd) {\r\n\t\t\t\twhile (lastBegin <= lastEnd) {\r\n\t\t\t\t\tparentDom.removeChild(lastChildren[lastBegin++].domNode!);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst lastLeft = lastEnd - lastBegin + 1;\r\n\t\t\t\tconst nextLeft = nextEnd - nextBegin + 1;\r\n\t\t\t\tconst sources: number[] = new Array(nextLeft);\r\n\t\t\t\tfor (let i = 0; i < nextLeft; i++) {\r\n\t\t\t\t\tsources[i] = -1;\r\n\t\t\t\t}\r\n\t\t\t\tlet moved = false;\r\n\t\t\t\tlet pos = 0;\r\n\t\t\t\tlet patched = 0;\r\n\r\n\t\t\t\tif (nextLeft <= 4 || lastLeft * nextLeft <= 16) {\r\n\t\t\t\t\tfor (let i = lastBegin; i <= lastEnd; i++) {\r\n\t\t\t\t\t\tlet lastNode = lastChildren[i];\r\n\t\t\t\t\t\tif (patched < nextLeft) {\r\n\t\t\t\t\t\t\tfor (let j = nextBegin; j <= nextEnd; j++) {\r\n\t\t\t\t\t\t\t\tlet nextNode = nextChildren[j];\r\n\t\t\t\t\t\t\t\tif (lastNode.props.key === nextNode.props.key) {\r\n\t\t\t\t\t\t\t\t\tsources[j - nextBegin] = i;\r\n\t\t\t\t\t\t\t\t\tif (pos > j) {\r\n\t\t\t\t\t\t\t\t\t\tmoved = true;\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tpos = j;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tpatchBothChild(\r\n\t\t\t\t\t\t\t\t\t\tnextNode,\r\n\t\t\t\t\t\t\t\t\t\tlastNode,\r\n\t\t\t\t\t\t\t\t\t\tnextChildren,\r\n\t\t\t\t\t\t\t\t\t\tj,\r\n\t\t\t\t\t\t\t\t\t\tparent\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\tpatched++;\r\n\t\t\t\t\t\t\t\t\tlastChildren[i] = null as any;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst keyIndex: { [key: string]: number } = {};\r\n\t\t\t\t\tfor (let i = nextBegin; i <= nextEnd; i++) {\r\n\t\t\t\t\t\tkeyIndex[nextChildren[i].props.key!] = i;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (let i = lastBegin; i < lastEnd; i++) {\r\n\t\t\t\t\t\tconst last = lastChildren[i];\r\n\t\t\t\t\t\tif (patched < nextLeft) {\r\n\t\t\t\t\t\t\tlet j = keyIndex[last.props.key!];\r\n\t\t\t\t\t\t\tif (j !== undefined) {\r\n\t\t\t\t\t\t\t\tconst next = nextChildren[j];\r\n\t\t\t\t\t\t\t\tsources[j - nextBegin] = i;\r\n\t\t\t\t\t\t\t\tif (pos > j) {\r\n\t\t\t\t\t\t\t\t\tmoved = true;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tpos = j;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tpatchBothChild(\r\n\t\t\t\t\t\t\t\t\tnext,\r\n\t\t\t\t\t\t\t\t\tlast,\r\n\t\t\t\t\t\t\t\t\tnextChildren,\r\n\t\t\t\t\t\t\t\t\tj,\r\n\t\t\t\t\t\t\t\t\tparent\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\tpatched++;\r\n\t\t\t\t\t\t\t\tlastChildren[i] = null as any;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (lastLeft === lastChildren.length && patched === 0) {\r\n\t\t\t\t\tparentDom.textContent = '';\r\n\t\t\t\t\twhile (nextBegin < nextLeft) {\r\n\t\t\t\t\t\tconst node = nextChildren[nextBegin];\r\n\t\t\t\t\t\tnextBegin++;\r\n\t\t\t\t\t\tvnodeToDomNode(node);\r\n\t\t\t\t\t\tparentDom.appendChild(node.domNode!);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet i = lastLeft - patched;\r\n\t\t\t\t\twhile (i > 0) {\r\n\t\t\t\t\t\tconst last = lastChildren[lastBegin];\r\n\t\t\t\t\t\tif (last !== null) {\r\n\t\t\t\t\t\t\tparentDom.removeChild(last.domNode!);\r\n\t\t\t\t\t\t\ti--;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (moved) {\r\n\t\t\t\t\t\tconst seq = lis(sources);\r\n\t\t\t\t\t\tlet j = seq.length - 1;\r\n\t\t\t\t\t\tfor (let i = nextLeft - 1; i >= 0; i--) {\r\n\t\t\t\t\t\t\tif (sources[i] === -1) {\r\n\t\t\t\t\t\t\t\tconst pos = i + nextBegin;\r\n\t\t\t\t\t\t\t\tconst node = nextChildren[pos];\r\n\t\t\t\t\t\t\t\tconst nextPos = pos + 1;\r\n\t\t\t\t\t\t\t\tvnodeToDomNode(node);\r\n\t\t\t\t\t\t\t\tif (nextPos < nextChildren.length) {\r\n\t\t\t\t\t\t\t\t\tparentDom.insertBefore(\r\n\t\t\t\t\t\t\t\t\t\tnode.domNode!,\r\n\t\t\t\t\t\t\t\t\t\tnextChildren[nextPos].domNode!\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tparentDom.appendChild(node.domNode!);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (j < 0 || i !== seq[j]) {\r\n\t\t\t\t\t\t\t\t\tconst pos = i + nextBegin;\r\n\t\t\t\t\t\t\t\t\tconst node = nextChildren[pos];\r\n\t\t\t\t\t\t\t\t\tconst nextPos = pos + 1;\r\n\t\t\t\t\t\t\t\t\tnode.domNode && vnodeToDomNode(node);\r\n\t\t\t\t\t\t\t\t\tif (nextPos < nextChildren.length) {\r\n\t\t\t\t\t\t\t\t\t\tparentDom.insertBefore(\r\n\t\t\t\t\t\t\t\t\t\t\tnode.domNode!,\r\n\t\t\t\t\t\t\t\t\t\t\tnextChildren[nextPos].domNode!\r\n\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tparentDom.appendChild(node.domNode!);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (patched !== nextLeft) {\r\n\t\t\t\t\t\tfor (let i = nextLeft - 1; i >= 0; i--) {\r\n\t\t\t\t\t\t\tif (sources[i] === -1) {\r\n\t\t\t\t\t\t\t\tconst pos = i + nextBegin;\r\n\t\t\t\t\t\t\t\tconst node = nextChildren[pos];\r\n\t\t\t\t\t\t\t\tconst nextPos = pos + 1;\r\n\t\t\t\t\t\t\t\tvnodeToDomNode(node);\r\n\t\t\t\t\t\t\t\tif (nextPos < nextChildren.length) {\r\n\t\t\t\t\t\t\t\t\tparentDom.insertBefore(\r\n\t\t\t\t\t\t\t\t\t\tnode.domNode!,\r\n\t\t\t\t\t\t\t\t\t\tnextChildren[nextPos].domNode!\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tparentDom.appendChild(node.domNode!);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {*/\r\n\t\tconst minLength = Math.min(lastLength, nextLength);\r\n\t\tlet i = 0;\r\n\t\twhile (i < minLength) {\r\n\t\t\tconst last = lastChildren[i],\r\n\t\t\t\tnext = nextChildren[i];\r\n\t\t\tpatchBothChild(next, last, nextChildren, i, parent);\r\n\t\t\ti++;\r\n\t\t}\r\n\t\tif (lastLength < nextLength) {\r\n\t\t\tfor (i = minLength; i < nextLength; i++) {\r\n\t\t\t\tif (parentDom !== null) {\r\n\t\t\t\t\tvnodeToDomNode(nextChildren[i]);\r\n\t\t\t\t\tparentDom.appendChild(nextChildren[i].domNode!);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (lastLength > nextLength) {\r\n\t\t\tfor (i = minLength; i < lastLength; i++) {\r\n\t\t\t\tparentDom.removeChild(lastChildren[i].domNode!);\r\n\t\t\t\tunmountRecursively(lastChildren[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// }\r\n\t}\r\n\tparent.children = nextChildren;\r\n}\r\n\r\nfunction patchBothChild(\r\n\tnext: VNode<IProps>,\r\n\tlast: VNode<IProps>,\r\n\tnextChildren: VNode<IProps>[],\r\n\ti: number,\r\n\tparent: VNode<IProps>\r\n) {\r\n\tif (next.vtype === 'component') {\r\n\t\tif (\r\n\t\t\tlast.vtype === 'component' &&\r\n\t\t\t(last.component as ComponentVNodeType).original ===\r\n\t\t\t(next.component as ComponentVNodeType).original\r\n\t\t) {\r\n\t\t\tnext.rendered = (last.component as ComponentVNodeType)(next.props);\r\n\t\t} else {\r\n\t\t\tnext.rendered = (next.component as ComponentVNodeType)(next.props);\r\n\t\t}\r\n\t}\r\n\tif (last.vtype === 'component' && next.vtype === 'component') {\r\n\t\tpatch(last, next.rendered!);\r\n\t\tlast.props = next.props;\r\n\t\tnextChildren[i] = last;\r\n\t\tunmount(next);\r\n\t} else if (\r\n\t\tlast.vtype !== next.vtype ||\r\n\t\t(last.vtype === 'text' &&\r\n\t\t\tnext.vtype === 'text' &&\r\n\t\t\tlast.component !== next.component) ||\r\n\t\t(last.vtype === 'dom' &&\r\n\t\t\tnext.vtype === 'dom' &&\r\n\t\t\tlast.component !== next.component)\r\n\t) {\r\n\t\tvnodeToDomNode(next);\r\n\t\tnext.parent = parent;\r\n\t\tparent.domNode!.replaceChild(next.domNode!, last.domNode!);\r\n\t\tunmountRecursively(last);\r\n\t} else if (last.vtype === 'dom' && next.vtype === 'dom') {\r\n\t\tpatchProps(last.domNode! as Element, last, last.props, next.props);\r\n\t\tpatchChildren(last, last.children!, next.children!);\r\n\t\tnextChildren[i] = last;\r\n\t\tunmountRecursively(next);\r\n\t} else if (last.vtype === 'text' && next.vtype === 'text') {\r\n\t\tnextChildren[i] = last;\r\n\t}\r\n}\r\n\r\n// remove state and effect of vnode\r\nfunction unmountRecursively(vnode: VNode) {\r\n\tnextTick2(() => {\r\n\t\tif (vnode.vtype === 'text') return;\r\n\t\tconst stack: VNode[] = [vnode];\r\n\t\tfor (; stack.length > 0;) {\r\n\t\t\tconst n = stack.pop()!;\r\n\t\t\tif (n.id) {\r\n\t\t\t\tbus.emit('unmount', n.id);\r\n\t\t\t}\r\n\t\t\tstack.push(...n.children!.filter((n) => n.vtype !== 'text'));\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction unmount(vnode: VNode) {\r\n\tvnode.vtype === 'component' &&\r\n\tnextTick2(() => bus.emit('unmount', vnode.id));\r\n}\r\n","import { patch } from './patchs';\r\nimport {\r\n\tisEventAttr,\r\n\tnextTick2,\r\n\tonEvent,\r\n\tsetProp,\r\n\tsetStyle,\r\n\tnextTick\r\n} from './kit';\r\nimport {\r\n\tComponentVNodeType,\r\n\tDOMVNodeType,\r\n\tEffect,\r\n\tignoreProps,\r\n\tTextVNodeType,\r\n\tVNode\r\n} from './types';\r\nimport bus from './bus';\r\n\r\nconst idToVNode: { [id: number]: VNode } = {};\r\n\r\nbus.on('unmount', (id: number) => {\r\n\tif (idToVNode[id] && idToVNode[id].pendingEffectReturns) {\r\n\t\tidToVNode[id].pendingEffectReturns!.forEach((f) => f());\r\n\t}\r\n\tdelete idToVNode[id];\r\n});\r\n\r\n// unkown reason: value of return sometime be undefined when vnode.vtype === 'text',\r\n// it is JS BUG?\r\nexport function vnodeToDomNode(vnode: VNode): Node {\r\n\tlet elem: Node;\r\n\tif (vnode.vtype === 'text') {\r\n\t\telem = document.createTextNode(vnode.component as TextVNodeType);\r\n\t} else if (vnode.vtype === 'dom') {\r\n\t\tconst e = (elem = document.createElement(\r\n\t\t\tvnode.component as DOMVNodeType\r\n\t\t));\r\n\t\tfor (let name in vnode.props) {\r\n\t\t\tif (name in ignoreProps) continue;\r\n\t\t\tif (isEventAttr(name)) {\r\n\t\t\t\tonEvent(e, name, vnode.props[name]);\r\n\t\t\t} else if (name === 'style') {\r\n\t\t\t\tfor (let style in vnode.props['style']) {\r\n\t\t\t\t\tsetStyle(e.style, style, vnode.props['style'][style]);\r\n\t\t\t\t}\r\n\t\t\t} else if (name === 'className' || name === 'class') {\r\n\t\t\t\te.className = vnode.props[name];\r\n\t\t\t} else if (\r\n\t\t\t\tname === 'dangerouslySetInnerHTML' &&\r\n\t\t\t\ttypeof vnode.props['dangerouslySetInnerHTML'].__html ===\r\n\t\t\t\t\t'string'\r\n\t\t\t) {\r\n\t\t\t\te.innerHTML = vnode.props['dangerouslySetInnerHTML'].__html;\r\n\t\t\t} else {\r\n\t\t\t\tsetProp(e, name, vnode.props[name]);\r\n\t\t\t\t// TODO: 支持 SVG\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (const child of vnode.children!) {\r\n\t\t\telem.appendChild(vnodeToDomNode(child));\r\n\t\t}\r\n\t} else if (vnode.vtype === 'component') {\r\n\t\tidToVNode[vnode.id!] = vnode;\r\n\t\tconst renderedVNode = (vnode.component as ComponentVNodeType)(\r\n\t\t\tvnode.props\r\n\t\t);\r\n\t\tvnode.rendered = renderedVNode;\r\n\t\trunPendingEffectReturns(vnode);\r\n\t\telem = vnodeToDomNode(renderedVNode);\r\n\t\trunPendingEffects(vnode);\r\n\t} else {\r\n\t\tthrow 'invalid type';\r\n\t}\r\n\tvnode.domNode = elem;\r\n\tvnode.props.ref && vnode.props.ref(elem as any);\r\n\t(elem as any)._vnode = vnode;\r\n\treturn vnode.domNode;\r\n}\r\n\r\nexport function updateVNode(id: number) {\r\n\tnextTick(() => {\r\n\t\tif (idToVNode[id] && idToVNode[id].vtype === 'component') {\r\n\t\t\tconst vnode = idToVNode[id];\r\n\t\t\tif (vnode.domNode) {\r\n\t\t\t\trunPendingEffectReturns(vnode);\r\n\t\t\t\tconst rendered = (vnode.component as ComponentVNodeType)(\r\n\t\t\t\t\tvnode.props\r\n\t\t\t\t);\r\n\t\t\t\tpatch(vnode, rendered);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\nexport function addPendingEffect(id: number, effect: Effect) {\r\n\tif (idToVNode[id] && idToVNode[id].vtype === 'component') {\r\n\t\tconst vnode = idToVNode[id];\r\n\t\tif (!vnode.pendingEffects) {\r\n\t\t\tvnode.pendingEffects = [];\r\n\t\t}\r\n\t\tvnode.pendingEffects.push(effect);\r\n\t}\r\n}\r\n\r\nexport function runPendingEffects(vnode: VNode | number) {\r\n\tif (\r\n\t\t(typeof vnode === 'object' &&\r\n\t\t\tvnode.vtype === 'component' &&\r\n\t\t\tidToVNode[vnode.id!]) ||\r\n\t\t(typeof vnode === 'number' &&\r\n\t\t\tidToVNode[vnode] &&\r\n\t\t\tidToVNode[vnode].vtype === 'component')\r\n\t) {\r\n\t\tvnode = typeof vnode === 'number' ? idToVNode[vnode] : vnode;\r\n\t\tif (vnode.pendingEffects) {\r\n\t\t\twhile (vnode.pendingEffects.length > 0) {\r\n\t\t\t\tconst effect = vnode.pendingEffects.pop()!;\r\n\t\t\t\tconst effectReturn = effect();\r\n\t\t\t\tif (effectReturn) {\r\n\t\t\t\t\tif (!vnode.pendingEffectReturns) {\r\n\t\t\t\t\t\tvnode.pendingEffectReturns = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvnode.pendingEffectReturns!.push(effectReturn);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function runPendingEffectReturns(vnode: VNode | number) {\r\n\tif (\r\n\t\t(typeof vnode === 'object' &&\r\n\t\t\tvnode.vtype === 'component' &&\r\n\t\t\tidToVNode[vnode.id!]) ||\r\n\t\t(typeof vnode === 'number' &&\r\n\t\t\tidToVNode[vnode] &&\r\n\t\t\tidToVNode[vnode].vtype === 'component')\r\n\t) {\r\n\t\tvnode = typeof vnode === 'number' ? idToVNode[vnode] : vnode;\r\n\t\tif (vnode.pendingEffectReturns) {\r\n\t\t\twhile (vnode.pendingEffectReturns.length > 0) {\r\n\t\t\t\tconst effectReturn = vnode.pendingEffectReturns!.pop()!;\r\n\t\t\t\teffectReturn();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","import { updateVNode, addPendingEffect } from './vnode';\r\nimport { equalsArray } from './kit';\r\nimport { Effect } from './types';\r\nimport bus from './bus';\r\n\r\nlet idCounter = 1;\r\n\r\nexport function getId() {\r\n\treturn idCounter++;\r\n}\r\n\r\nconst idToSE: {\r\n\t[id: number]: {\r\n\t\tstates: {\r\n\t\t\tlength: number;\r\n\t\t\t[index: number]: {\r\n\t\t\t\tstate: any;\r\n\t\t\t};\r\n\t\t};\r\n\t\teffects: {\r\n\t\t\tlength: number;\r\n\t\t\t[index: number]: {\r\n\t\t\t\teffectReturn?: () => void;\r\n\t\t\t\tinputs?: any[];\r\n\t\t\t};\r\n\t\t};\r\n\t};\r\n} = {};\r\n\r\nbus.on('unmount', (id: number) => delete idToSE[id]);\r\n\r\nlet currId: number;\r\nlet iterState: number;\r\nlet iterEffect: number;\r\n\r\nexport function beginRender(id: number) {\r\n\tcurrId = id;\r\n\titerState = 0;\r\n\titerEffect = 0;\r\n}\r\n\r\nexport function endRender(id: number) {\r\n\r\n}\r\n\r\nexport function useState<S = any>(initState: S): [S, (s: S) => void] {\r\n\tconst id = currId;\r\n\tconst i = iterState;\r\n\titerState++;\r\n\tif (!idToSE[id]) {\r\n\t\tidToSE[id] = {\r\n\t\t\tstates: {\r\n\t\t\t\tlength: 0\r\n\t\t\t},\r\n\t\t\teffects: {\r\n\t\t\t\tlength: 0\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\tconst se = idToSE[id];\r\n\tif (!se.states[i]) {\r\n\t\tse.states.length++;\r\n\t\tse.states[i] = { state: initState };\r\n\t}\r\n\treturn [\r\n\t\tse.states[i].state,\r\n\t\t(s: S) => {\r\n\t\t\tse.states[i].state = s;\r\n\t\t\tupdateVNode(id);\r\n\t\t}\r\n\t];\r\n}\r\n\r\nexport function useEffect(effect: Effect, inputs?: any[]) {\r\n\tconst id = currId;\r\n\tconst i = iterEffect;\r\n\titerEffect++;\r\n\tif (!idToSE[id]) {\r\n\t\tidToSE[id] = {\r\n\t\t\tstates: {\r\n\t\t\t\tlength: 0\r\n\t\t\t},\r\n\t\t\teffects: {\r\n\t\t\t\tlength: 0\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\tconst se = idToSE[id];\r\n\tif (!se.effects[i]) {\r\n\t\tse.effects.length++;\r\n\t\tse.effects[i] = {};\r\n\t}\r\n\tconst effected = se.effects[i];\r\n\tif (!inputs || (inputs && !equalsArray(effected.inputs, inputs))) {\r\n\t\taddPendingEffect(id, effect);\r\n\t\teffected.inputs = inputs;\r\n\t}\r\n}\r\n","import {\r\n\tVNodeType,\r\n\tVNode,\r\n\tIProps,\r\n\tTextVNodeType,\r\n\tComponentVNodeType,\r\n\tisVNode\r\n} from './types';\r\nimport { getId, endRender,beginRender } from './hooks';\r\nimport { isNullOrUndef } from './kit';\r\n\r\nexport function createElement(\r\n\ttype: VNodeType,\r\n\tprops: IProps,\r\n\t...children: VNode[]\r\n): VNode {\r\n\tif (!props) props = {};\r\n\tif (props.key && typeof props.key !== 'string')\r\n\t\tprops.key = JSON.stringify(props.key);\r\n\tconst isArr = Array.isArray(props.children);\r\n\tif (props.children && !isArr) {\r\n\t\tprops.children = [ props.children as VNode ];\r\n\t} else if (!props.children) {\r\n\t\tprops.children = children;\r\n\t}\r\n\tprops.children = children = (props.children as VNode[])\r\n\t\t.filter((child) => !isNullOrUndef(child))\r\n\t\t.reduce(\r\n\t\t\t(prev: VNode[], curr) => (\r\n\t\t\t\tArray.isArray(curr)\r\n\t\t\t\t\t? prev.push(...(curr as any))\r\n\t\t\t\t\t: prev.push(curr),\r\n\t\t\t\tprev\r\n\t\t\t),\r\n\t\t\t[]\r\n\t\t);\r\n\tlet vnode: VNode;\r\n\tif (typeof type === 'string') {\r\n\t\t// dom vnode\r\n\t\tvnode = {\r\n\t\t\tvtype: 'dom',\r\n\t\t\tcomponent: type,\r\n\t\t\tchildren,\r\n\t\t\tprops\r\n\t\t};\r\n\t} else if (typeof type === 'function') {\r\n\t\tconst id = getId();\r\n\t\tconst packType = function(props: any): VNode {\r\n\t\t\tbeginRender(id);\r\n\t\t\tconst rendered = (type as ComponentVNodeType)(props);\r\n\t\t\tendRender(id);\r\n\t\t\treturn rendered;\r\n\t\t};\r\n\t\t(packType as ComponentVNodeType).original = type;\r\n\t\tvnode = {\r\n\t\t\tid,\r\n\t\t\tvtype: 'component',\r\n\t\t\tcomponent: packType as ComponentVNodeType,\r\n\t\t\tchildren,\r\n\t\t\tprops\r\n\t\t};\r\n\t} else {\r\n\t\tthrow 'invalid type';\r\n\t}\r\n\tfor (let i = 0; i < children.length; i++) {\r\n\t\tif (typeof children[i] === 'string') {\r\n\t\t\tchildren[i] = {\r\n\t\t\t\tvtype: 'text',\r\n\t\t\t\tcomponent: (children[i] as any) as TextVNodeType,\r\n\t\t\t\tchildren: [],\r\n\t\t\t\tprops: {}\r\n\t\t\t};\r\n\t\t} else if (\r\n\t\t\ttypeof children[i] === 'boolean' ||\r\n\t\t\ttypeof children[i] === 'number' ||\r\n\t\t\ttypeof children[i] === 'bigint' ||\r\n\t\t\ttypeof children[i] === 'symbol' ||\r\n\t\t\ttypeof children[i] === 'undefined' ||\r\n\t\t\t!isVNode(children[i])\r\n\t\t) {\r\n\t\t\tchildren[i] = {\r\n\t\t\t\tvtype: 'text',\r\n\t\t\t\tcomponent: (JSON.stringify(children[i]) || '') as TextVNodeType,\r\n\t\t\t\tchildren: [],\r\n\t\t\t\tprops: {}\r\n\t\t\t};\r\n\t\t}\r\n\t\t// @ts-ignore\r\n\t\tchildren[i].parent = vnode;\r\n\t}\r\n\t// @ts-ignore\r\n\treturn vnode;\r\n}\r\n","import { VNode } from './types';\r\nimport { vnodeToDomNode } from './vnode';\r\n\r\nexport function render(vnode: VNode, container: Element, callback?: Function) {\r\n\tvnodeToDomNode(vnode);\r\n\tcontainer.appendChild(vnode.domNode!);\r\n}\r\n","import {createElement} from './createElement';\r\nimport {render} from './render';\r\nimport {useState, useEffect} from './hooks';\r\n\r\nexport const h = createElement;\r\n\r\nexport {createElement, render, useState, useEffect};\r\n"],"sourceRoot":""}